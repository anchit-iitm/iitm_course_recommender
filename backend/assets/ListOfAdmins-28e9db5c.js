import{_ as x,o as u,c,w as a,a as i,k as f,b as p,d as r,e as o,M as g,g as A,a8 as T,L as I,l as $,ab as V,ac as k}from"./index-9925a73e.js";import{V as E}from"./VDataTable-e9157179.js";import{V as D,a as j}from"./VToolbar-ee674691.js";import{V as m}from"./VSpacer-5de82b03.js";import{V as C}from"./VDialog-a5dd7237.js";import{V as y}from"./VContainer-cade46d0.js";import{V as v}from"./VRow-fd607537.js";import{V as O}from"./VTextField-25b902d9.js";import{V as w}from"./VAutocomplete-81ff8f98.js";import"./VSelect-e75dd184.js";import"./dialog-transition-6afa3e57.js";import"./VTable-f84be96b.js";import"./filter-283fec11.js";const z={data:()=>({groupBy:[{key:"role",order:"asc"}],all_emails:[],search:"",admins:[],dialog:!1,dialogDelete:!1,headers:[{title:"Email",align:"start",key:"id"},{title:"Name",key:"name"},{title:"Created At",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{id:"",role:""},defaultItem:{id:"",role:"admin"}}),computed:{formTitle(){return this.editedIndex===-1?"Add Member":"Edit Member"},editMode(){return this.editedIndex!==-1}},watch:{dialog(t){t||this.close()},dialogDelete(t){t||this.closeDelete()}},created(){this.initialize()},methods:{initialize:async function(){let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(e=>e.json().then(l=>({response:e,data:l}))).then(({response:e,data:l})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${l.msg}`);for(var s in l)this.admins.push({id:l[s].email,name:l[s].name,role:l[s].role,created_at:l[s].created_at})}).catch(e=>{console.log(e)}),await fetch("/api/v1/student/all",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(e=>e.json().then(l=>({response:e,data:l}))).then(({response:e,data:l})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${l.msg}`);for(var s in l)this.all_emails.push({id:l[s].email,name:l[s].name,role:l[s].role,created_at:l[s].created_at})}).catch(e=>{console.log(e)})},editItem(t){this.editedIndex=this.admins.indexOf(t),this.editedItem=Object.assign({},t),this.dialog=!0},deleteItem(t){this.editedIndex=this.admins.indexOf(t),this.editedItem=Object.assign({},t),this.dialogDelete=!0},deleteItemConfirm:async function(){let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({email:this.admins[this.editedIndex].id})}).then(e=>e.json().then(l=>({response:e,data:l}))).then(({response:e,data:l})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${l.message}`);this.admins.splice(this.editedIndex,1),this.$root.vtoast.show({message:"Admin Deleted",color:"warning"})}).catch(e=>{this.$root.vtoast.show({message:e.message,color:"error"})}),this.closeDelete()},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save:async function(){let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:this.editedIndex>-1?"PATCH":"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({email:this.editedIndex>-1?this.editedItem.id:this.editedItem.id.id,role:this.editedItem.role})}).then(e=>e.json().then(l=>({response:e,data:l}))).then(({response:e,data:l})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${l.message}`);this.editedIndex>-1?(Object.assign(this.admins[this.editedIndex],this.editedItem),this.$root.vtoast.show({message:"Admin info updated"})):(this.all_emails.splice(this.all_emails.findIndex(s=>s.id===this.editedItem.id.id),1),this.editedItem.id.role=this.editedItem.role,this.admins.push(this.editedItem.id),this.$root.vtoast.show({message:"Admin Added",color:"success"}))}).catch(e=>{this.$root.vtoast.show({message:e.message,color:"error"})}),this.close()}}},B=["colspan"],M={class:"text-h5"};function S(t,e,l,s,N,n){return u(),c(y,null,{default:a(()=>[i(f,{elevation:"2"},{default:a(()=>[i(E,{headers:t.headers,items:t.admins,"group-by":t.groupBy,"items-per-page":"25"},{"group-header":a(({item:d,columns:h,toggleGroup:b,isGroupOpen:_})=>[p("tr",null,[p("td",{colspan:h.length},[i(r,{size:"small",variant:"text",icon:_(d)?"$expand":"$next",onClick:U=>b(d)},null,8,["icon","onClick"]),o(" "+g(d.value=="admin"?"Administrators":d.value=="ctm"?"Course Team Members":"IITM Management"),1)],8,B)])]),top:a(()=>[i(D,{flat:""},{default:a(()=>[i(j,null,{default:a(()=>[o("Admin Members")]),_:1}),i(A,{class:"mx-4",inset:"",vertical:""}),i(m),i(C,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=d=>t.dialog=d),"max-width":"500px"},{activator:a(({props:d})=>[i(r,T({color:"primary",dark:"",class:"mb-2"},d),{default:a(()=>[o(" Add Administrator ")]),_:2},1040)]),default:a(()=>[i(f,null,{default:a(()=>[i(I,null,{default:a(()=>[p("span",M,g(n.formTitle),1)]),_:1}),i($,null,{default:a(()=>[i(y,null,{default:a(()=>[i(v,null,{default:a(()=>[n.editMode?(u(),c(O,{key:0,modelValue:t.editedItem.id,"onUpdate:modelValue":e[0]||(e[0]=d=>t.editedItem.id=d),label:"Email Address",readonly:""},null,8,["modelValue"])):(u(),c(w,{key:1,modelValue:t.editedItem.id,"onUpdate:modelValue":e[1]||(e[1]=d=>t.editedItem.id=d),label:"Email Address",items:t.all_emails,"item-title":"id","return-object":""},null,8,["modelValue","items"]))]),_:1}),i(v,null,{default:a(()=>[i(w,{modelValue:t.editedItem.role,"onUpdate:modelValue":e[2]||(e[2]=d=>t.editedItem.role=d),label:"Access Level",items:["admin","ctm","im"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(V,null,{default:a(()=>[i(m),i(r,{color:"secondary",variant:"text",onClick:n.close},{default:a(()=>[o(" Cancel ")]),_:1},8,["onClick"]),i(r,{color:"primary",variant:"text",onClick:n.save},{default:a(()=>[o(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(C,{modelValue:t.dialogDelete,"onUpdate:modelValue":e[4]||(e[4]=d=>t.dialogDelete=d),"max-width":"500px"},{default:a(()=>[i(f,null,{default:a(()=>[i(I,{class:"text-center"},{default:a(()=>[o("Are you sure you want to delete this item?")]),_:1}),i(V,null,{default:a(()=>[i(m),i(r,{color:"primary",onClick:n.closeDelete},{default:a(()=>[o("Cancel")]),_:1},8,["onClick"]),i(r,{color:"red",onClick:n.deleteItemConfirm},{default:a(()=>[o("OK")]),_:1},8,["onClick"]),i(m)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":a(({item:d})=>[i(k,{size:"small",class:"me-2",onClick:h=>n.editItem(d)},{default:a(()=>[o(" mdi-pencil ")]),_:2},1032,["onClick"]),i(k,{size:"small",onClick:h=>n.deleteItem(d)},{default:a(()=>[o(" mdi-delete ")]),_:2},1032,["onClick"])]),"no-data":a(()=>[i(r,{color:"primary",onClick:n.initialize},{default:a(()=>[o(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","items","group-by"])]),_:1})]),_:1})}const Z=x(z,[["render",S]]);export{Z as default};
