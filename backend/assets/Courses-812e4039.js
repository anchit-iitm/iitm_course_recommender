import{_ as D,o as f,c as A,w as l,a as t,k as c,e as i,g as $,d as r,a8 as j,L as C,l as I,ab as p,b as T,M as v,j as y,N as _,O as E,ac as w}from"./index-9925a73e.js";import{V as x}from"./VDataTable-e9157179.js";import{V as O,a as B}from"./VToolbar-ee674691.js";import{V as m}from"./VSpacer-5de82b03.js";import{V as g}from"./VDialog-a5dd7237.js";import{V}from"./VContainer-cade46d0.js";import{V as u}from"./VRow-fd607537.js";import{V as k}from"./VTextField-25b902d9.js";import{V as S}from"./VSelect-e75dd184.js";import{V as b}from"./VAutocomplete-81ff8f98.js";import"./VTable-f84be96b.js";import"./filter-283fec11.js";import"./dialog-transition-6afa3e57.js";const z={data:()=>({groupBy:[{key:"level"}],all_emails:[],search:"",courses:[],dialog:!1,addDialog:!1,addCourse:{id:"",name:"",instructors:[],level:""},dialogDelete:!1,headers:[{title:"Course Code",align:"start",key:"id"},{title:"Name",key:"name"},{title:"Difficulty Rating",key:"difficulty_rating"},{title:"Instructors",key:"instructors"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{name:"",instructors:[]},defaultItem:{name:"",instructors:[]}}),computed:{formTitle(){return this.editedIndex===-1?"Add Course":"Edit Course"},editMode(){return this.editedIndex!==-1}},watch:{dialog(a){a||this.close()},addDialog(a){a||this.closeAdd()},dialogDelete(a){a||this.closeDelete()}},created(){this.initialize()},methods:{initialize:async function(){let a=sessionStorage.getItem("token");await fetch("/api/v1/courses/all",{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(e=>e.json().then(o=>({response:e,data:o}))).then(({response:e,data:o})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${o.msg}`);this.courses=o}).catch(e=>{console.log(e)}),await fetch("/api/v1/admin",{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(e=>e.json().then(o=>({response:e,data:o}))).then(({response:e,data:o})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${o.msg}`);for(var n in o)o[n].role=="ctm"&&this.all_emails.push({email:o[n].email,name:o[n].name,role:o[n].role,created_at:o[n].created_at})}).catch(e=>{console.log(e)})},editItem(a){this.editedIndex=this.courses.indexOf(a),this.editedItem=Object.assign({},a),this.dialog=!0},deleteItem(a){this.editedIndex=this.courses.indexOf(a),this.editedItem=Object.assign({},a),this.dialogDelete=!0},deleteItemConfirm:async function(){this.closeDelete();let a=sessionStorage.getItem("token");await fetch("/api/v1/courses/"+this.courses[this.editedIndex].id,{method:"DELETE",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(e=>e.json().then(o=>({response:e,data:o}))).then(({response:e,data:o})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${o.message}`);this.courses.splice(this.editedIndex,1),this.$root.vtoast.show({message:"Course Deleted",color:"warning"})}).catch(e=>{this.$root.vtoast.show({message:e.message,color:"error"})})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeAdd(){this.addDialog=!1,this.$nextTick(()=>{this.addCourse=Object.assign({},{id:"",name:"",instructors:[],level:""})})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save:async function(){let a=sessionStorage.getItem("token");await fetch("/api/v1/courses/"+this.editedItem.id,{method:"PATCH",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({name:this.editedItem.name,instructors:this.editedItem.instructors})}).then(e=>e.json().then(o=>({response:e,data:o}))).then(({response:e,data:o})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${o.msg}`);Object.assign(this.courses[this.editedIndex],this.editedItem),this.$root.vtoast.show({message:"Course Info Updated"})}).catch(e=>{this.$root.vtoast.show({message:e.message,color:"error"})}),this.close()},saveAdd:async function(){let a=sessionStorage.getItem("token");await fetch("/api/v1/courses/all",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({code:this.addCourse.id,name:this.addCourse.name,instructors:this.addCourse.instructors,level:this.addCourse.level})}).then(e=>e.json().then(o=>({response:e,data:o}))).then(({response:e,data:o})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${o.msg}`);this.courses.push(this.addCourse),this.$root.vtoast.show({message:"Course Added"})}).catch(e=>{this.$root.vtoast.show({message:e.message,color:"error"})}),this.closeAdd()}}},U=T("span",{class:"text-h5"},"Add Course",-1),N={class:"text-h5"},L={class:"mt-2"};function M(a,e,o,n,P,d){return f(),A(V,null,{default:l(()=>[t(c,{elevation:"2"},{default:l(()=>[t(x,{headers:a.headers,items:a.courses,"group-by":a.groupBy,"items-per-page":"25"},{top:l(()=>[t(O,{flat:""},{default:l(()=>[t(B,null,{default:l(()=>[i("Courses")]),_:1}),t($,{class:"mx-4",inset:"",vertical:""}),t(m),t(g,{modelValue:a.addDialog,"onUpdate:modelValue":e[4]||(e[4]=s=>a.addDialog=s),"max-width":"500px"},{activator:l(({props:s})=>[t(r,j({color:"primary",dark:"",class:"mb-2"},s),{default:l(()=>[i(" Add Course ")]),_:2},1040)]),default:l(()=>[t(c,null,{default:l(()=>[t(C,null,{default:l(()=>[U]),_:1}),t(I,null,{default:l(()=>[t(V,null,{default:l(()=>[t(u,null,{default:l(()=>[t(k,{modelValue:a.addCourse.id,"onUpdate:modelValue":e[0]||(e[0]=s=>a.addCourse.id=s),label:"Course Code"},null,8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(k,{modelValue:a.addCourse.name,"onUpdate:modelValue":e[1]||(e[1]=s=>a.addCourse.name=s),label:"Course Name"},null,8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(S,{items:["foundation","diploma","degree"],modelValue:a.addCourse.level,"onUpdate:modelValue":e[2]||(e[2]=s=>a.addCourse.level=s),label:"Course Level"},null,8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(b,{modelValue:a.addCourse.instructors,"onUpdate:modelValue":e[3]||(e[3]=s=>a.addCourse.instructors=s),label:"Course Team Members",items:a.all_emails,"item-title":"email",multiple:"","return-object":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m),t(r,{color:"secondary",variant:"text",onClick:d.closeAdd},{default:l(()=>[i(" Cancel ")]),_:1},8,["onClick"]),t(r,{color:"primary",variant:"text",onClick:d.saveAdd},{default:l(()=>[i(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(g,{modelValue:a.dialog,"onUpdate:modelValue":e[7]||(e[7]=s=>a.dialog=s),"max-width":"500px"},{default:l(()=>[t(c,null,{default:l(()=>[t(C,null,{default:l(()=>[T("span",N,v(d.formTitle),1)]),_:1}),t(I,null,{default:l(()=>[t(V,null,{default:l(()=>[t(u,null,{default:l(()=>[t(k,{modelValue:a.editedItem.name,"onUpdate:modelValue":e[5]||(e[5]=s=>a.editedItem.name=s),label:"Course Name"},null,8,["modelValue"])]),_:1}),t(u,null,{default:l(()=>[t(b,{modelValue:a.editedItem.instructors,"onUpdate:modelValue":e[6]||(e[6]=s=>a.editedItem.instructors=s),label:"Course Team Members",items:a.all_emails,"item-title":"email",multiple:"","return-object":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(m),t(r,{color:"secondary",variant:"text",onClick:d.close},{default:l(()=>[i(" Cancel ")]),_:1},8,["onClick"]),t(r,{color:"primary",variant:"text",onClick:d.save},{default:l(()=>[i(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(g,{modelValue:a.dialogDelete,"onUpdate:modelValue":e[8]||(e[8]=s=>a.dialogDelete=s),"max-width":"500px"},{default:l(()=>[t(c,null,{default:l(()=>[t(C,{class:"text-center"},{default:l(()=>[i("Are you sure you want to delete this item?")]),_:1}),t(p,null,{default:l(()=>[t(m),t(r,{color:"primary",onClick:d.closeDelete},{default:l(()=>[i("Cancel")]),_:1},8,["onClick"]),t(r,{color:"red",onClick:d.deleteItemConfirm},{default:l(()=>[i("OK")]),_:1},8,["onClick"]),t(m)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.instructors":l(({item:s})=>[(f(!0),y(_,null,E(s.instructors,h=>(f(),y("p",L,v(h.name),1))),256))]),"item.actions":l(({item:s})=>[t(w,{size:"small",class:"me-2",onClick:h=>d.editItem(s)},{default:l(()=>[i(" mdi-pencil ")]),_:2},1032,["onClick"]),t(w,{size:"small",onClick:h=>d.deleteItem(s)},{default:l(()=>[i(" mdi-delete ")]),_:2},1032,["onClick"])]),"no-data":l(()=>[t(r,{color:"primary",onClick:d.initialize},{default:l(()=>[i(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","items","group-by"])]),_:1})]),_:1})}const te=D(z,[["render",M]]);export{te as default};
