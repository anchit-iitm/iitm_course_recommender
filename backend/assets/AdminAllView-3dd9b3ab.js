import{_ as v,o as h,e as c,w as l,a as i,a0 as f,V as r,b as o,$ as I,a9 as w,L as A,a1 as p,a7 as g,a2 as E,aC as V,d as k}from"./index-af240f69.js";import{V as C}from"./VContainer-dc02ce2b.js";import{V as $,a as y,b}from"./VDialog-6276a2be.js";import{a as D,V as j}from"./VToolbar-55e5ff65.js";import{V as m}from"./VSpacer-e5f6d90b.js";import{V as x}from"./VRow-3a9fd07a.js";import{b as O}from"./VTextField-4d733c1f.js";/* empty css              */import"./VList-1b92a4dd.js";import"./ssrBoot-cde2e447.js";import"./scopeId-6e8d15e4.js";const z={data:()=>({groupBy:[{key:"role",order:"asc"}],all_emails:[],search:"",admins:[],dialog:!1,dialogDelete:!1,headers:[{title:"Email",align:"start",key:"id"},{title:"Name",key:"name"},{title:"Created At",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{id:"",role:""},defaultItem:{id:"",role:"admin"}}),computed:{formTitle(){return this.editedIndex===-1?"Add Member":"Edit Member"},editMode(){return this.editedIndex!==-1}},watch:{dialog(t){t||this.close()},dialogDelete(t){t||this.closeDelete()}},created(){this.initialize()},methods:{initialize:async function(){let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(e=>e.json().then(a=>({response:e,data:a}))).then(({response:e,data:a})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${a.msg}`);for(var s in a)this.admins.push({id:a[s].email,name:a[s].name,role:a[s].role,created_at:a[s].created_at})}).catch(e=>{console.log(e)}),await fetch("/api/v1/student/all",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}).then(e=>e.json().then(a=>({response:e,data:a}))).then(({response:e,data:a})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${a.msg}`);for(var s in a)this.all_emails.push({id:a[s].email,name:a[s].name,role:a[s].role,created_at:a[s].created_at})}).catch(e=>{console.log(e)})},editItem(t){this.editedIndex=this.admins.indexOf(t),this.editedItem=Object.assign({},t),this.dialog=!0},deleteItem(t){this.editedIndex=this.admins.indexOf(t),this.editedItem=Object.assign({},t),this.dialogDelete=!0},deleteItemConfirm:async function(){this.closeDelete();let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({email:this.admins[this.editedIndex].id})}).then(e=>e.json().then(a=>({response:e,data:a}))).then(({response:e,data:a})=>{if(!e.ok)throw new Error(`Error ${e.status}: ${a.msg}`);this.admins.splice(this.editedIndex,1)}).catch(e=>{e.message.includes("Token has expired"),console.log(e)})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save:async function(){let t=sessionStorage.getItem("token");await fetch("/api/v1/admin",{method:this.editedIndex>-1?"PATCH":"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({email:this.editedIndex>-1?this.editedItem.id:this.editedItem.id.id,role:this.editedItem.role})}).then(e=>e.json().then(a=>({response:e,data:a}))).then(({response:e,data:a})=>{if(!e.ok)throw a.error!=null?(this.errors.push(a.error),new Error(`Error ${e.status}: ${a.error}`)):(this.errors.push(a.msg),new Error(`Error ${e.status}: ${a.msg}`));this.editedIndex>-1?Object.assign(this.admins[this.editedIndex],this.editedItem):(this.all_emails.splice(this.all_emails.findIndex(s=>s.id===this.editedItem.id.id),1),this.editedItem.id.role=this.editedItem.role,this.admins.push(this.editedItem.id))}).catch(e=>{console.log(e)}),this.close()}}},B=["colspan"],S={class:"text-h5"};function M(t,e,a,s,N,n){return h(),c(C,null,{default:l(()=>[i(p,{elevation:"2"},{default:l(()=>[i($,{headers:t.headers,items:t.admins,"group-by":t.groupBy,"items-per-page":"25"},{"group-header":l(({item:d,columns:u,toggleGroup:T,isGroupOpen:_})=>[f("tr",null,[f("td",{colspan:u.length},[i(r,{size:"small",variant:"text",icon:_(d)?"$expand":"$next",onClick:U=>T(d)},null,8,["icon","onClick"]),o(" "+I(d.value=="admin"?"Administrators":d.value=="ctm"?"Course Team Members":"IITM Management"),1)],8,B)])]),top:l(()=>[i(D,{flat:""},{default:l(()=>[i(j,null,{default:l(()=>[o("Admin Members")]),_:1}),i(w,{class:"mx-4",inset:"",vertical:""}),i(m),i(y,{modelValue:t.dialog,"onUpdate:modelValue":e[3]||(e[3]=d=>t.dialog=d),"max-width":"500px"},{activator:l(({props:d})=>[i(r,A({color:"primary",dark:"",class:"mb-2"},d),{default:l(()=>[o(" Add Administrator ")]),_:2},1040)]),default:l(()=>[i(p,null,{default:l(()=>[i(g,null,{default:l(()=>[f("span",S,I(n.formTitle),1)]),_:1}),i(E,null,{default:l(()=>[i(C,null,{default:l(()=>[i(x,null,{default:l(()=>[n.editMode?(h(),c(O,{key:0,modelValue:t.editedItem.id,"onUpdate:modelValue":e[0]||(e[0]=d=>t.editedItem.id=d),label:"Email Address",readonly:""},null,8,["modelValue"])):(h(),c(b,{key:1,modelValue:t.editedItem.id,"onUpdate:modelValue":e[1]||(e[1]=d=>t.editedItem.id=d),label:"Email Address",items:t.all_emails,"item-title":"id","return-object":""},null,8,["modelValue","items"]))]),_:1}),i(x,null,{default:l(()=>[i(b,{modelValue:t.editedItem.role,"onUpdate:modelValue":e[2]||(e[2]=d=>t.editedItem.role=d),label:"Access Level",items:["admin","ctm","im"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(V,null,{default:l(()=>[i(m),i(r,{color:"secondary",variant:"text",onClick:n.close},{default:l(()=>[o(" Cancel ")]),_:1},8,["onClick"]),i(r,{color:"primary",variant:"text",onClick:n.save},{default:l(()=>[o(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(y,{modelValue:t.dialogDelete,"onUpdate:modelValue":e[4]||(e[4]=d=>t.dialogDelete=d),"max-width":"500px"},{default:l(()=>[i(p,null,{default:l(()=>[i(g,{class:"text-center"},{default:l(()=>[o("Are you sure you want to delete this item?")]),_:1}),i(V,null,{default:l(()=>[i(m),i(r,{color:"primary",onClick:n.closeDelete},{default:l(()=>[o("Cancel")]),_:1},8,["onClick"]),i(r,{color:"red",onClick:n.deleteItemConfirm},{default:l(()=>[o("OK")]),_:1},8,["onClick"]),i(m)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":l(({item:d})=>[i(k,{size:"small",class:"me-2",onClick:u=>n.editItem(d)},{default:l(()=>[o(" mdi-pencil ")]),_:2},1032,["onClick"]),i(k,{size:"small",onClick:u=>n.deleteItem(d)},{default:l(()=>[o(" mdi-delete ")]),_:2},1032,["onClick"])]),"no-data":l(()=>[i(r,{color:"primary",onClick:n.initialize},{default:l(()=>[o(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","items","group-by"])]),_:1})]),_:1})}const X=v(z,[["render",M]]);export{X as default};
